name: Publish nf-core/tools API documentation
on:
  push:
    branches: [master, dev]

jobs:
  build-n-publish:
    name: Build and publish nf-core to PyPI
    runs-on: ubuntu-18.04

    steps:
      - name: Check out source-code repository
        uses: actions/checkout@v2

      - name: Build HTML docs
        run: make --directory ./docs/api html

      - name: Push docs to api-doc branch
        if: github.repository == 'nf-core/tools'
        run: |
          git checkout --orphan api-doc
          git rm -r --cache .
          git add docs
          git commit --message "nf-core/tools docs build"
          git remote add nf-core "https://${NF_CORE_BOT}@github.com/nf-core/tools.git" > /dev/null 2>&1
          git push --force --quiet --set-upstream nf-core api-doc
